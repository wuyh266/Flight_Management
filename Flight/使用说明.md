# 订票系统使用说明

## 功能概述

这是一个类似携程App的订票系统，支持航班、火车、汽车票的查询和预订。

## 主要功能

1. **用户注册和登录**
   - 用户注册：输入用户名、密码并确认密码
   - 用户登录：使用注册的用户名和密码登录

2. **票务查询**
   - 支持按出发地、目的地、日期、类型（航班/火车/汽车）查询
   - 显示可用票务列表，包括价格、出发时间、到达时间等信息

3. **订票功能**
   - 选择票务后点击"订票"按钮
   - 填写乘客信息（姓名、身份证、联系电话）
   - 选择购票数量
   - 确认订单并支付（模拟支付，订单状态直接设为已支付）

4. **订单管理**
   - 在个人中心查看所有订单
   - 可以取消已支付的订单
   - 取消订单后座位会自动恢复

## 数据库配置

### 1. 创建数据库

首先需要在MySQL中创建数据库：

```sql
CREATE DATABASE Flight;
USE Flight;
```

### 2. 执行初始化脚本

运行项目根目录下的 `init_database.sql` 文件来创建表结构和示例数据：

```bash
mysql -u root -p Flight < init_database.sql
```

或者在MySQL命令行中：

```sql
source init_database.sql;
```

### 3. 修改数据库连接信息

如果您的MySQL配置不同，需要修改以下文件中的数据库连接信息：

- `MainWindow.cpp` 中的 `ConnectDatabase()` 函数
- `sign_in.cpp` 中的数据库连接代码

修改以下参数：
- `setHostName("127.0.0.1")` - MySQL服务器地址
- `setPort(3306)` - MySQL端口
- `setDatabaseName("Flight")` - 数据库名
- `setUserName("root")` - MySQL用户名
- `setPassword("@WUyh0601")` - MySQL密码

## 数据库表结构

### users 表（用户表）
- UserID: 用户ID（主键，自增）
- Username: 用户名（唯一）
- PWord: 密码
- CreatedTime: 创建时间

### tickets 表（票务表）
- TicketID: 票务ID（主键，自增）
- TicketType: 类型（Flight/Train/Bus）
- TicketNo: 票务编号
- DepartureCity: 出发城市
- ArrivalCity: 到达城市
- DepartureTime: 出发时间
- ArrivalTime: 到达时间
- Price: 价格
- TotalSeats: 总座位数
- AvailableSeats: 可用座位数
- Company: 公司名称
- Status: 状态（Available/SoldOut/Cancelled）

### orders 表（订单表）
- OrderID: 订单ID（主键，自增）
- UserID: 用户ID（外键）
- TicketID: 票务ID（外键）
- OrderNo: 订单号（唯一）
- PassengerName: 乘客姓名
- PassengerIDCard: 乘客身份证号
- ContactPhone: 联系电话
- TicketCount: 购票数量
- TotalPrice: 总价
- OrderStatus: 订单状态（Pending/Paid/Cancelled/Completed）
- OrderTime: 下单时间

## 编译和运行

1. 使用Qt Creator打开 `Management.pro` 文件
2. 配置Qt版本（需要Qt 6.9.2或更高版本）
3. 确保MySQL驱动已安装
4. 编译项目
5. 运行程序

## 使用流程

1. **注册账号**
   - 打开程序，点击"注册"按钮
   - 输入用户名和密码，确认密码
   - 点击注册按钮完成注册

2. **登录系统**
   - 输入注册的用户名和密码
   - 点击"登录"按钮

3. **查询票务**
   - 在首页输入出发地、目的地等信息
   - 选择日期和类型（可选）
   - 点击"搜索"按钮
   - 查看搜索结果列表

4. **预订票务**
   - 在搜索结果中点击"订票"按钮
   - 填写乘客信息
   - 选择购票数量
   - 点击"确认订票"按钮

5. **查看订单**
   - 点击"个人中心"按钮
   - 查看所有订单列表
   - 可以取消已支付的订单

## 注意事项

1. 确保MySQL服务已启动
2. 确保数据库连接信息正确
3. 确保已执行数据库初始化脚本
4. 系统使用本地数据库，不需要联网
5. 订单支付为模拟支付，订单状态直接设为已支付

## 技术栈

- Qt 6.9.2
- C++17
- MySQL数据库
- Qt SQL模块

## 项目结构

```
Management/
├── MainWindow.cpp/h/ui      # 主窗口（登录界面）
├── sign_in.cpp/h/ui         # 注册界面
├── deal.cpp/h/ui            # 订票主界面
├── single_center.cpp/h/ui   # 个人中心
├── order_dialog.cpp/h/ui    # 订单对话框
├── main.cpp                 # 程序入口
├── Management.pro           # 项目配置文件
└── init_database.sql        # 数据库初始化脚本
```

## 常见问题

1. **数据库连接失败**
   - 检查MySQL服务是否启动
   - 检查数据库连接信息是否正确
   - 检查数据库是否已创建

2. **编译错误**
   - 确保Qt版本正确
   - 确保MySQL驱动已安装
   - 检查项目配置文件是否正确

3. **查询无结果**
   - 检查数据库是否有数据
   - 检查查询条件是否正确
   - 检查数据库表是否已创建

